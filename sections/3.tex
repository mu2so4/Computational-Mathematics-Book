\documentclass[../main.tex]{subfile}

\begin{document}

\section{Численные методы интегрирования}

Как мы находили определённый интеграл от функции $f(x)$ на отрезке $[a,b]$? Мы
всевозможными способами искали первообразную $F(x)$, а затем по формуле
Ньютона-Лейбница $\int_a^bf(x)dx=F(b)-F(a)$ вычисляли его значение. И эта
формула работала.

Проблемы начинаются тогда, когда у функции не получается найти первообразную
или она выглядит слишком сложно или страшно, чтобы в неё что-то там подставлять.
Наконец, функция может быть задана таблично, а не аналитической функцией.

Это значит, что отталкиваться придётся только от исходной функции $f(x)$. О том,
как приближённо найти интеграл без первообразной, и будет рассказано в этой главе.

\begin{define}
	\textbf{Задача численного интегрирования} -- задача нахождения
	определённого интеграла функции без использования её первообразной и
	формулы Ньютона-Лейбница.
\end{define}

Наиболее часто для численного интегрирования используется следующая формула.

\begin{define}\label{eq:quadrature_formula}
	\textbf{Квадратурная формула} -- формула вида
	\[\int_a^bf(x)dx\approx\sum_{k=0}^n c_kf(x_k),\]
	где $c_k$ -- \textbf{весовые коэффициенты}, а $x_k\in[a,b]$ --
	\textbf{узлы интегрирования}.
\end{define}

\begin{define}
	\textbf{Кубатурная формула} -- формула вида
	\[\int_{D}f(x)dx\approx\sum_{k=0}^n c_k f(x_k),\quad x_k\in D,\;D
	\subseteq\mathbb R^m,\;m\ge 2.\]
\end{define}

\begin{define}
	\textbf{Сетка} -- это совокупность узлов $\{x_1,...,x_n\}$ квадратурной
	или кубатурной формулы.
\end{define}

\begin{define}
	\textbf{Погрешность квадратурной формулы} или её \textbf{остаточный
	член} -- это разность
	\[R(f)=\int_a^b f(x)dx - \sum_{k=0}^n c_kf(x_k).\]
\end{define}

\begin{define}
	Квадратурная формула называется \textbf{точной} для функции $f$ или
	класса $\mathcal F\ni f$ на интервале $[a,b]$, если верно $R(f)=0$.
\end{define}

То, насколько широк класс $\mathcal F$, на которых квадратурная формула точна,
может говорить о точности квадратурной формулы в целом. Часто в качестве класса
''пробных'' функций $\mathcal F$ берут алгебраические полиномы.

\begin{define}\label{eq:algebraic_degree_of_accuracy}
	\textbf{Алгебраическая степень точности} квадратурной формулы --
	наибольшая степень алгебраического полинома, для которого эта формула
	точна на всей вещественной оси.
\end{define}

Конечно, для нас предпочтительней формулы с б\'{о}льшей алгебраической степенью
точности.

\subsection{Формулы Ньютона-Котеса}
Простейший приём построения квадратурных формул -- замена подынтегральной
функции $f(x)$ на интервале интегрирования $[a,b]$ на ''более простую'',
легче интегрируемую функцию. Подынтегральную функцию чаще всего интерполируют
алгебраическими полиномами.\newpage

\begin{define}
	\textbf{Интерполяционная квадратурная формула} -- квадратурная формула
	\eqref{eq:quadrature_formula}, которая заменяет исходную функцию $f(x)$
	интерполянтом по простым (то есть не кратным) узлам $\{x_1,...,x_n\}$:
	\[f(x)\approx g(x)=\sum_{k=0}^{n}f(x_k)\gamma_k(x),\]
	где $\gamma_k(x)$ -- некоторые функции. Тогда интеграл приблизительно
	равен
	\[\int_{a}^{b}f(x)dx\approx\sum_{k=0}^{n}f(x_k)
	\underset{c_k}{\underbrace{\int_{a}^{b}\gamma_k(x)dx}}.\]
\end{define}

\begin{define}\label{eq:newton_cotes_formula}
	\textbf{Формула Ньютона-Котеса} -- интерполяционная квадратурная
	формула, полученная с помощью алгебраической интерполяции
	\eqref{eq:interpolating_polynomial} подынтегральной функции на
	равномерной сетке с простыми узлами на отрезке $[a,b]$.
\end{define}

\begin{define}
	\begin{itemize}[nosep, before = \leavevmode\vspace{-\baselineskip}]
		\item Формула Ньютона-Котеса \textbf{замкнутого типа},
			если оба предела интегрирования являются узлами
			интерполяции.
		\item Формула Ньютона-Котеса \textbf{открытого типа},
			если она не замкнутого типа.
	\end{itemize}
\end{define}

\subsection{Формулы прямоугольников}
Очевидно, что простейшая квадратурная формула -- это просто взять константу.

\begin{define}\label{eq:rectangle_rule}
	\textbf{Формула прямоугольников} -- квадратурная формула Ньютона-Котеса
	открытого типа, интерполяционная функция которой задаётся единственным
	узлом $x_0\in[a,b]$ и, следовательно, равна константе. Формула имеет вид
	\[\boxed{\int_{a}^{b}f(x)dx\approx f(x_0)(b-a)}\]
\end{define}

Название идёт из того, что она совпадает с площадью прямоугольника со сторонами
$(b-a)$ и $f(x_0)$. Не нужно забывать, что геометрический смысл интеграла -- это
площадь фигуры под графиком функции.

\begin{define}\label{eq:rectangle_rule_vars}
	Если в формуле \eqref{eq:rectangle_rule} $x_0$ такой, что
	\begin{itemize}[noitemsep, nolistsep]
		\item $x_0=a$, это \textbf{формула левого прямоугольника}.
		\item $x_0=b$, это \textbf{формула правого прямоугольника}.
		\item $x_0=\frac{a+b}{2}$, это \textbf{формула среднего
			прямоугольника}.
	\end{itemize}
	\subfile{graphs/3.2-rectangle-rules}

\end{define}

\begin{theorem}[об оценке погрешности формулы средних прямоугольников]
\label{eq:middle_rectangle_rule_error}
	Погрешность формулы средних прямоугольников для интеграла $\int_a^b
	f(x)dx$ может быть оценена следующим неравенством:
	\[\boxed{|R(f)|\le\frac{M_2|h|^3}{24}},\]
	где $h=b-a$, $M_i=\underset{x\in[a,b]}{max}|f^{(i)}(x)|.$
\end{theorem}

\begin{proof}
	Разложим функцию $f(x)$ в ряд Тейлора:
	\[f(x)=f(c)+f'(c)(x-c)+\frac{f''(\xi)(x-c)^2}{2},\]
	где $c=\frac{a+b}{2},\;\xi\in[a,b].$ Погрешность квадратурной формулы
	равна:
	\[R(f)=\int_a^b f(x)dx - f(c)(b-a)=\int_a^b\big(f(x) - f(c)\big)
	dx=\]
	\[=\int_a^b \Big(\cancel{f'(c)(x-c)}+\frac{f''(\xi)(x-c)^2}{2}\Big)dx=
	\frac{f''(\xi)(x-c)^3}{6}\Big|_a^b=\]
	\[=\frac{f''(\xi)}{6}\Big((b-c)^3-(a-c)^3\Big)=\frac{f''(\xi)}{6}2\Big(
	\frac{h}{2}\Big)^3=\frac{f''(\xi)h^3}{24}.\]

	Теперь оценка очевидна:
	\[|R(f)|=\Big|\frac{f''(\xi)h^3}{24}\Big|\le\frac{M_2|h|^3}{24}.
	\]
\end{proof}

Оценка неулучшаема, поскольку она достигается для интеграла\\
$\int_a^b(x-\frac{1}{2}(a+b))^2dx$.

\begin{theorem}[об оценке погрешности формулы правых и левых прямоугольников]
\label{eq:rl_rectangle_rule_error}
	Погрешность формулы правых и левых прямоугольников для интеграла
	$\int_a^b f(x)dx$ может быть оценена следующим неравенством:
	\[\boxed{|R(f)|\le\frac{M_1h^2}{2}}\]
\end{theorem}

\begin{proof}
	Для определённости будем считать, что мы ищем погрешность для формулы
	левых прямоугольников; для правых доказательство аналогичное. Разложив
	функцию $f(x)$ в ряд Тейлора только до первой производной и проделав
	тот же путь, что и в \eqref{eq:middle_rectangle_rule_error}, получим
	следующее:
	\[|R(f)|=\Big|\;\frac{f'(\xi)(x-a)^2}{2}\Big|_a^b\;\Big|=
	\Big|\frac{f'(\xi)h^2}{2}\Big|\le\frac{M_1h^2}{2}.\]
\end{proof}

\begin{corollary}
	Формулы средних прямоугольников имеют алгебраическую степень
	точности \eqref{eq:algebraic_degree_of_accuracy}, равную 1, а у всех
	остальных формул прямоугольников, в том числе правых и левых, -- 0.
\end{corollary}

\begin{example}\label{eq:rectangle_rules_example}
	Найдём интеграл
	\[I=\int_{\pi/4}^{\pi/2}\sin x\;dx\]
	всеми тремя формулами прямоугольников \eqref{eq:rectangle_rule_vars}.
	Чтобы было с чем сравнить, посчитаем $I$ через формулу Ньютона-Лейбница:
	\[I=-\cos x\Big|_{\pi/4}^{\pi/2}=\frac{1}{\sqrt 2}\approx 0.707.\]

	Подготовим синус значения посередине для формулы средних прямоугольников
	и длину отрезка интегрирования:
	\[\frac{a+b}{2}=\frac{3\pi}{8}\Rightarrow\sin{\frac{3\pi}{8}}=
	\sqrt{\frac{1-\cos{\frac{3\pi}{4}}}{2}}=\frac{1}{2}\sqrt{2+\sqrt{2}}
	\approx 0.924,\]
	\[b-a=\frac{\pi}{4}\approx\frac{3.14}{4}=0.785.\]

	Теперь посчитаем интеграл квадратурными формулами:
	\begin{itemize}[nosep]
		\item $I\approx I(a)\approx 0.707\cdot 0.785\approx 0.555,\quad
			R(f)\approx 0.152,$
		\item $I\approx I(b)\approx 1\cdot 0.785=0.785,\quad
			R(f)\approx -0.078,$
		\item $I\approx I(\frac{a+b}{2})\approx 0.924\cdot 0.785\approx
			0.725,\quad R(f)\approx -0.018.$
	\end{itemize}\leavevmode\newline

	Формула средних прямоугольников ожидаемо показала лучший результат.
	Но мы всё равно оценим, в каких границах она могла быть.

	Оценка погрешности формул правых и левых прямоугольников
	\eqref{eq:rl_rectangle_rule_error} примерно равна
	\[|R(f)|\le\frac{M_1h^2}{2}=\frac{1}{2\cdot\sqrt 2}\Big(\frac{\pi}{4}
	\Big)^2\approx \frac{0.707\cdot(0.785)^2}{2}\approx 0.218.\]

	Оценка погрешности формул средних прямоугольников
	\eqref{eq:middle_rectangle_rule_error} примерно равна
	\[|R(f)|\le\frac{M_2|h|^3}{24}=\frac{1}{24}\Big(\frac{\pi}{4}\Big)^3
	\approx\frac{(0.785)^3}{24}\approx 0.024.\]

	Полученные оценки погрешностей квадратурных формул довольно близки к
	реальным значениям.
\end{example}
\newpage

\subsection{Формула трапеций}
На пути у нас формула Ньютона-Котеса первой степени, то есть $n=1$.

\begin{define}
	\textbf{Формула трапеций} -- квадратурная формула Ньютона-Котеса
	замкнутого типа \eqref{eq:newton_cotes_formula}, интерполяционная
	функция которой задаётся двумя узлами и, следовательно, является
	уравнением прямой.
\end{define}

\begin{theorem}[формула трапеций]\label{eq:trapezoidal_rule}
	Формула трапеций для интеграла $\int_a^b f(x)dx$ имеет
	вид
	\[\boxed{\int_a^b f(x)dx\approx\frac{b-a}{2}\big(f(a)+f(b)\big)}\]
\end{theorem}

\begin{proof}
	Представим интерполяционный полином квадратурной формулы в форме
	Лагранжа \eqref{eq:lagrange_polynomial}:
	\[P_1(x)=\frac{x-b}{a-b}f(a)+\frac{x-a}{b-a}f(b).\]
	Проинтегрировав это равенство, получим:
	\[\int_a^b P_1(x)dx=\frac{f(a)}{a-b}\int_a^b (x-b)dx +
	\frac{f(b)}{b-a}\int_a^b (x-a)dx=\]
	\[=\frac{f(a)}{a-b}\frac{(x-b)^2}{2}\Big|_a^b+\frac{f(b)}{b-a}
	\frac{(x-a)^2}{2}\Big|_a^b=\frac{b-a}{2}\big(f(a)+f(b)\big).\]
\end{proof}

Так же, как и формулы прямоугольников, формула трапеций получила своё название
благодаря тому, что графически это площадь трапеции:
\subfile{graphs/3.3-trapezoidal-rule-compared}

\begin{theorem}[об оценке погрешности формулы трапеций]
\label{eq:trapezoidal_rule_error}
	Погрешность формулы трапеций для интеграла $\int_a^b f(x)dx$ может быть
	оценена следующим неравенством:
	\[\boxed{|R(f)|\le\frac{M_2|h|^3}{12}},\quad
	h=b-a,\;M_2=\underset{x\in[a,b]}{max}|f^{(2)}(x)|.\]
\end{theorem}

\begin{proof}
	Для оценки погрешности вспомним значение погрешности интерполяционного
	полинома \eqref{eq:interpolation_der_error_form}:
	\[f(x)-P_1(x)=\frac{f''(\xi)}{2}(x-a)(x-b),\]
	где $\xi=\xi(x)\in[a,b]$. От погрешности интерполяции перейдём к
	погрешности интеграла:
	\[R(f)=\int_a^b\frac{f''(\xi)}{2}(x-a)(x-b)dx=\frac{f''(\xi)}{2}\int_a^b
	(x-a)(x-b)dx.\]
	$\big|\frac{f''(\xi)}{2}\big|\le\big|\frac{M_2}{2}\big|$, интеграл же
	посчитаем:
	\[\int_a^b(x-a)(x-b)dx=\frac{x^3}{3}\;\Big|_a^b-(a+b)\frac{x^2}{2}\;
	\Big|_a^b+abx\;\Big|_a^b=\]
	\[=\frac{h}{6}\Big(2(a^2+ab+b^2)-3(a^2+2ab+b^2)+6ab\Big)=-\frac{h^3}{6}.
	\]
	Окончательно имеем
	\[|R(f)|\le\frac{M_2|h|^3}{12}.\]
\end{proof}

Эта оценка также неулучшаема: она достигается для интеграла\\
$\int_a^b (a+b)^2dx$.

\begin{corollary}
	Формула средних прямоугольников имеют алгебраическую степень
	точности \eqref{eq:algebraic_degree_of_accuracy}, равную 1.
\end{corollary}

\begin{example}\label{eq:trapezoidal_rule_example}
	Применим формулу трапеций \eqref{eq:trapezoidal_rule} к интегралу из
	примера \eqref{eq:rectangle_rules_example}:
	\[I\approx \frac{\pi/2-\pi/4}{2}\Big(\sin{\frac{\pi}{4}}+\sin{\frac{\pi}
	{2}}\Big)\approx 0.392\cdot 1.707\approx 0.669,\quad R(f)\approx 0.038.\]

	По погрешности формула проиграла лишь формуле средних прямоугольников.
	Как и тогда, оценим, в каких границах она могла
	\eqref{eq:trapezoidal_rule_error} быть:
	\[|R(f)|\le\frac{M_2|h|^3}{12}=\frac{1}{12}\Big(\frac{\pi}{4}
	\Big)^3\approx\frac{(0.785)^3}{12}\approx 0.040.\]

	В нашем случае, оценка погрешности почти была достигнута.
\end{example}

\subsection{Формула парабол (Симпсона)}
После полинома первой степени (прямой) идёт полином степени второй, или же
парабола.

\begin{define}
	\textbf{Формула парабол} или \textbf{Формула Симпсона} -- квадратурная
	формула Ньютона-Котеса \eqref{eq:newton_cotes_formula} замкнутого типа,
	интерполяционная функция которой задаётся тремя узлами: граничными и
	серединным, -- и, следовательно, является уравнением параболы.
\end{define}

\begin{theorem}[формула Симпсона]\label{eq:simpsons_1_3_rule}
	Формула Симпсона для интеграла $\int_a^b f(x)dx$ имеет вид
	\[\boxed{\int_a^b f(x)dx\approx\frac{b-a}{6}\Big(f(a)+4f\big(\frac{a+b}
	{2}\big)+f(b)\Big)}\]
\end{theorem}

\begin{proof}
	Обозначим $c=\frac{a+b}{2}$, $h=b-a$. Представим интерполяционный полином
	в форме Ньютона
	\eqref{eq:newton_polynomial}:
	\[P_2(x)=P_1(x)+f[a,b,c](x-a)(x-b).\]
	Из \eqref{eq:trapezoidal_rule} и из доказательства
	\eqref{eq:trapezoidal_rule_error}
	\[\int_a^b P_1(x)dx=\frac{h}{2}\big(f(a)+f(b)\big),\quad\int_a^b (x-a)
	(x-b)dx=-\frac{h^3}{6}.\]
	Посчитаем разделённые разности:
	\[f[a,b]=\frac{f(b)-f(a)}{b-a}=\frac{f(b)-f(a)}{h},\]
	\[f[b,c]=\frac{f(c)-f(b)}{c-b}=2\cdot\frac{f(b)-f(c)}{h},\]
	\[f[a,b,c]=\frac{2\cdot\frac{f(b)-f(c)}{h}-\frac{f(b)-f(a)}{h}}{h/2}=
	\frac{2}{h^2}\big(f(a)-2f(c)+f(b)\big).\]
	Окончательно получаем:
	\[\int_a^b P_2(x)dx=\frac{h}{2}\big(f(a)+f(b)\big)-\frac{h^{\cancel{3}}}
	{6}\frac{2}{\cancel{h^2}}\big(f(a)-2f(c)+f(b)\big)=\]
	\[=\frac{h}{6}\big(f(a)+4f(c)+f(b)\big).\]
\end{proof}

Однако данное доказательство нашёл я. У С. П. Шарого и на лекции было совсем
другое доказательство. Приведём и его.

\begin{proof}
	Задача -- построить параболу $P_2(x)$ по трём точкам $(a,f(a))$,
	$\big(\frac{a+b}{2},f(\frac{a+b}{2})\big)$ и $(b,f(b))$. Для упрощения
	расчётов произведём параллельный перенос криволинейной трапеции, площадь
	которой мы и пытаемся найти, так, чтобы точка $a$ совпала с осью
	абсцисс -- отрезок интегрирования перейдёт в $[0,b-a]$. Обозначим
	$h=b-a$ и $m=\frac{a+b}{2}$.

	Пусть $P_2^*(x)=c_1+c_2x+c_3x^2$ -- полином второй степени, являющийся
	интерполянтом сдвинутой функции $f(x+a)=g(x)$. Соответственно, полином
	$P_2^*(x)$ проходит через точки $(0,g(0))$, $\big(\frac{h}{2},
	g(\frac{h}{2})\big)$ и $(h,g(h))$. Составим систему уравнений:
	\begin{equation*}
		\begin{cases}
			c_1 = f(a), \\
			c_1 + \mathlarger{\frac{h}{2}}c_2 + \mathlarger{\frac
				{h^2}{4}}c_3 = f(m), \\
			c_1 + h c_2 + h^2 c_3 = f(b). \\
		\end{cases}
	\end{equation*}

	Интеграл равен
	\[\int_a^b P_2(x)dx=\int_0^h P_2^*(x)dx=\Big(c_1x+\frac{c_2x^2}{2}+
	\frac{c_3x^3}{3}\Big)\Big|_0^h=\]
	\[\frac{h}{6}(6c_1+3c_2h+2c_3h^2).\]
	Решать систему выше необязательно, так как полученный трёхчлен легко
	выражается через уравнения системы: домжожим второе уравнение на 4,
	сложим его с первым и третьим и получим:
	\[\int_a^b P_2(x)dx=\frac{h}{6}\big(f(a)+4f(m)+f(b)\big).\]
\end{proof}

\subfile{graphs/3.4-simpsons-1_3-rule-compared}

\begin{lemma}
	Алгебраическая степень точности \eqref{eq:algebraic_degree_of_accuracy}
	формулы Симпсона \eqref{eq:simpsons_1_3_rule} равна трём.
\end{lemma}

\begin{proof}
	Точность формулы Симпсона для полиномов степени, не большей 2, следует
	из построения интерполяционного полинома, чья степень равна 2. Теперь
	проверим её точность для третьей степени на мономе $x^3$:
	\[\int_a^b x^3dx=\frac{b^4-a^4}{4}.\]
	Теперь найдём приближённо интеграл формулой Симпсона:
	\[\int_a^b P_2(x)dx=\frac{b-a}{6}\Big(a^3+\frac{(a+b)^3}{2}+b^3\Big)=\]
	\[\frac{b-a}{\cancel{12}\;4}(\cancel{3}a^3+\cancel{3}a^2b+\cancel{3}ab^2
	+\cancel{3}b^3)=\frac{b^4-a^4}{4}=\int_a^b x^3dx.\]

	После того как мы доказали точность формулы для третьей степени, докажем
	её неточность для четвёртой на мономе $x^4$:
	\[\int_a^b x^4dx=\frac{b^5-a^5}{5},\]
	а по формуле
	\[\int_a^b P_2(x)dx=\frac{b-a}{6}\Big(a^4+\frac{(a+b)^4}{4}+b^4\Big)=\]
	\[=\frac{b-a}{24}(5a^4+4a^3b+6a^2b^2+4ab^3+5b^4)\ne\frac{b^5-a^5}{5}.\]
\end{proof}

\begin{theorem}[оценка погрешности формулы Симпсона]
\label{eq:simpsons_1_3_rule_error}
	Погрешность формулы Симпсона для интеграла $\int_a^b f(x)dx$ может быть
	оценена следующим неравенством:
	\[\boxed{|R(f)|\le\frac{M_4|h|^5}{2880}},\]
	где $h=b-a$, $M_4=\underset{x\in[a,b]}{max}|f^{(4)}(x)|.$
\end{theorem}

\begin{proof}
	В предыдущей лемме мы установили, что алгебраическая точность формулы
	Симпсона выше степени интерполяционного полинома, который интерполирует
	подынтегральное выражение. Значит, для оценки погрешности следует
	использовать интерполяционный полином третьей степени, что при начичии
	всего трёх узлов интерполяции означает повторное использование
	имеющихся. Пусть мы повторно взяли серединный узел $c=\frac{a+b}{2}$.
	Тогда по оценке \eqref{eq:interpolation_der_error_form}
	\[f(x)-P_3(x)=\frac{f^{(4)}(\xi)}{24}(x-a)(x-c)^2(x-b).\]
	Посчитаем значение нашего интеграла:
	\[\int_a^b (x-a)(x-c)^2(x-b)dx=
		\begin{bmatrix}
			t=x-c,	& a'=a-c=-h/2 \\
			x=t+c,	& b'=b-c=h/2\\
		\end{bmatrix}
		=
	\]
	\[=\int_{-h/2}^{h/2}\Big(t+\frac{h}{2}\Big)t^2\Big(t-\frac{h}{2}\Big)dt=
	2\int_0^{h/2}t^2\Big(t^2-\frac{h^2}{4}\Big)dt=\]
	\[=2\Big(\frac{t^5}{5}-\frac{h^2t^3}{12}\Big)\;\Big|_0^{h/2}=
	-\frac{h^5}{120}.\]
	Окончательно получаем
	\[\Big|\frac{f^{(4)}(\xi)}{24}\Big|\le\frac{M_4}{24},\;\int_a^b\omega(x)
	dx=-\frac{h^5}{120}\quad\Rightarrow\quad|R(f)|\le\frac{M_4|h|^5}{2880}.\]
\end{proof}

\begin{example}\label{eq:simpsons_1_3_rule_example}
	Применим формулу Симпсона \eqref{eq:simpsons_1_3_rule} к интегралу из
	того же примера \eqref{eq:rectangle_rules_example}. Оттуда же получаем
	\[\sin{\frac{a+b}{2}}=\sin{\frac{3\pi}{8}}\approx 0.9239,\quad
	I=\int_{\pi/4}^{\pi/2}\sin x\;dx=\frac{1}{\sqrt 2}\approx 0.7071.\]

	Тогда интеграл примерно равен
	\[I\approx\frac{\pi/2-\pi/4}{6}\Big(\sin\frac{\pi}{4}+4\sin\frac{3\pi}
	{8}+\sin\frac{\pi}{2}\Big)\approx\]
	\[\approx\frac{3.1416}{24}(0.7071+4\cdot0.9239+1)\approx0.7072,\quad
	R(f)\approx -0.0001.\]

	Именно ради погрешности в одну десятитысячную пришлось увеличить
	количество знаков после запятой. Впрочем, оценка
	\eqref{eq:simpsons_1_3_rule_error} тоже радует:
	\[|R(f)|\le\frac{M_4|h|^5}{2880}=\frac{1}{2880}\Big(\frac{\pi}{4}
	\Big)^5\approx 0.0001.\]

	Без учёта округлений чисел, оценка погрешности почти была достигнута.
\end{example}

\subsection{Формула трёх восьмых}
Коротко представим квадратурную формулу, которая использует полиномы третьей
степени для интерполяции подынтегральной функции.

\begin{define}
	\textbf{Формула трёх восьмых} -- квадратурная формула Ньютона-Котеса
	\eqref{eq:newton_cotes_formula} замкнутого типа, интерполяционная
	функция которой задаётся четырьмя узлами и, следовательно, является
	уравнением кубической параболы.
\end{define}

\begin{theorem}[формула трёх восьмых]\label{eq:simpsons_3_8_rule}
	Формула трёх восьмых для интеграла $\int_a^b f(x)dx$ имеет вид
	\[\boxed{\int_a^b f(x)dx\approx\frac{3h}{8}\big(f(a)+3f(a+h)+3f(b-h)+
	f(b)\big)},\]
	где $3h=b-a$.
\end{theorem}
\proofexercise

\subfile{graphs/3.5-simpsons-3_8-rule-compared}

\begin{lemma}
	Алгебраическая степень точности \eqref{eq:algebraic_degree_of_accuracy}
	формулы трёх восьмых равна трём.
\end{lemma}
\proofexercise

\begin{theorem}[оценка погрешности формулы трёх восьмых]
\label{eq:simpsons_3_8_rule_error}
	Погрешность формулы трёх восьмых для интеграла $\int_a^b f(x)dx$ может
	быть оценена следующим неравенством:
	\[\boxed{|R(f)|\le\frac{M_4|b-a|^5}{6480}}\]
\end{theorem}
\proofexercise
\newpage

\begin{example}
	Завершим рассмотрение вычисления интеграла из примера
	\eqref{eq:rectangle_rules_example} и применим к нему формулу трёх
	восьмых. В этот раз будем брать 5 знаков после запятой:
	\[I=\int_{\pi/4}^{\pi/2}\sin x\;dx=\frac{1}{\sqrt 2}\approx 0.70711.\]

	Найдём промежуточные узлы интерполяции и найдём от них синусы:
	\[c_1=\frac{2a+b}{3}=\frac{\pi}{3},\quad\sin\frac{\pi}{3}=\frac{\sqrt 3}
	{2}\approx 0.86603,\]
	\[c_2=\frac{a+2b}{3}=\frac{5\pi}{12},\quad\sin\frac{5\pi}{12}=
	\sqrt\frac{1-\cos\frac{5\pi}{6}}{2}=\frac{1}{2}\sqrt{2+\sqrt 3}
	\approx 0.96593.\]

	Теперь можно вычислить интеграл:
	\[I\approx\frac{\pi/2-\pi/4}{8}\Big(\sin\frac{\pi}{4}+
	3\sin\frac{\pi}{3}+3\sin\frac{5\pi}{12}+\sin\frac{\pi}{2}\Big)
	\approx 0.70715,\]
	\[R(f)\approx -0.00004.\]

	Формула трёх восьмых ожидаемо показала лучший результат по сравнению с
	примерами \eqref{eq:rectangle_rules_example},
	\eqref{eq:trapezoidal_rule_example} и
	\eqref{eq:simpsons_1_3_rule_example}. Сопоставим погрешность с её оценкой:

	\[|R(f)|\le\frac{M_4|h|^5}{6480}=\frac{1}{6480}\Big(\frac{\pi}{4}
	\Big)^5\approx 0.000046.\]
\end{example}

\subsection{Составные квадратурные формулы}
Всё, что мы сейчас рассмотрели, были так называемые простые квадратурные
формулы, то есть мы их применяли сразу ко всему отрезку интегрирования. Однако
погрешность таких формул резко возрастает с ростом длины отрезка интегрирования.
Чтобы уменьшить её, есть два пути: взять квадратурную формулу, который использует
интерполяционный полином более высокой степени, или применить полученные формулы
не ко всему отрезку интегрирования сразу, а на его отдельных частях, не забыв
затем сложить полученные результаты. Мы рассмотрим второй метод.

\begin{define}
	\textbf{Простая квадратурная формула} -- квадратурная формула
	\eqref{eq:quadrature_formula}, которая применяется ко всему отрезку
	интегрирования $[a,b]$.
\end{define}

\begin{define}
	\textbf{Разбиение отрезка} $[a,b]$ на $N$ частей -- совокупность
	отрезков $[x_k,x_{k+1}]$ такая, что $k\in\{0,1,...,n\},\;x_0=a,\;x_{N+1}
	=b,\;x_i<x_j\;\text{при}\;i<j$. Получившиеся отрезки называются
	\textbf{элементарными}.
\end{define}

\begin{define}
	\textbf{Отрезок частичного интегрирования} -- часть основного отрезка,
	на котором производится интегрирование. Он может включать в себя один
	или несколько \underline{последовательных} элементарных отрезков.
\end{define}

\begin{define}
	\textbf{Составная квадратурная формула} с разбиением на $N$ отрезков --
	квадратурная формула \eqref{eq:quadrature_formula}, которая применяет
	простую квадратурную формулу на каждом из $N$ равных по длине, попарно
	неперекрывающихся и покрывающих весь отрезок интегрирования $[a,b]$
	отрезков частичного интегрирования.
\end{define}

\begin{theorem}[составная формула средних прямоугольников]
\label{eq:composite_middlepoint_rectangle_rule}
	\textbf{Составная формула средних прямоугольников} с разбиением на $N$
	отрезков имеет вид
	\[\boxed{\int_a^b f(x)dx\approx h\sum_{i=1}^{N}f\Big(\frac{x_{i-1}+x_i}
	{2}\Big),\quad h=\frac{b-a}{N}}\]
\end{theorem}

\begin{proof}
	Формула легко выводится из простой формулы \\
	\eqref{eq:rectangle_rule} со сложением частичных результатов.
\end{proof}

\begin{theorem}[составная формула трапеций]
\label{eq:composite_trapezoidal_rule}
	\textbf{Составная формула трапеций} с разбиением на $N$ отрезков имеет вид
	\[\boxed{\int_a^b f(x)dx\approx \frac{h}{2}\Big(f(a)+2\sum_{i=1}^{N-1}
	f(x_i)+f(b)\Big),\quad h=\frac{b-a}{N}}\]
\end{theorem}

\begin{proof}
	Аналогично предыдущей формуле из \eqref{eq:trapezoidal_rule}.
\end{proof}

\begin{theorem}[составная формула Симпсона]
\label{eq:composite_simpsons_1_3_rule}
	\textbf{Составная формула Симпсона} с разбиением на $N$ отрезков имеет вид
	\[\boxed{\int_a^b f(x)dx\approx \frac{h}{6}\Big(f(a)+2\sum_{i=1}^{N-1}
	f(x_{2i})+4\sum_{j=1}^{N}f(x_{2j-1})+f(b)\Big),\quad h=\frac{b-a}{N}}\]
\end{theorem}

\begin{proof}
	Аналогично предыдущим формулам из \eqref{eq:simpsons_1_3_rule}.
\end{proof}

\begin{remark}
	Составная формула Симпсона с разбиением на $N$ отрезков использует $2N$
	равных по длине элементарных отрезка разбиения.
\end{remark}

\begin{theorem}[составная формула трёх восьмых]
\label{eq:composite_simpsons_3_8_rule}
	\textbf{Составная формула трёх восьмых} с разбиением на $N$ отрезков
	имеет вид
	\[\boxed{\int_a^b f(x)dx\approx \frac{h}{8}\Big(f(a)+2\sum_{i=1}^{N-1}
	f(x_{3i})+3\sum_{j=1}^{N}f(x_{3j-1}+x_{3j-2})+f(b)\Big)}\]
	\[\quad h=\frac{b-a}{N}\]
\end{theorem}

\begin{proof}
	Аналогично предыдущим формулам из \eqref{eq:simpsons_3_8_rule}.
\end{proof}

\begin{remark}
	Составная формула трёх восьмых с разбиением на $N$ отрезков использует
	$3N$
	равных по длине элементарных отрезка разбиения.
\end{remark}

Как и в случае простых формул, нужно оценить погрешности составных. В данном
случае, мы также можем оценить, насколько точнее стала формула после того, как
применили на частях отрезка.
\newpage

\begin{theorem}
	Если оценка погрешности простой квадратурной формулы на отрезке $[a,b]$
	имеет вид
	\[|R(f)|\le \frac{M_p|H|^{p+1}}{C},\]
	где $M_p=\underset{x\in[a,b]}{max}|f^{(p)}(x)|$, $H=b-a$, а $C$ --
	некоторая константа, то оценка погрешности её составной версии с
	разбиением на $N$ отрезков имеет вид
	\[|R^*(f)|\le N\frac{M_p|h|^{p+1}}{C}=\frac{M_p|H|^{p+1}}{CN^p}.\]
\end{theorem}

\begin{proof}
	Рассмотрим равномерную сетку разбиения отрезка $\{x_0=a,x_1,...,
	x_N=b\}$. Обозначим
	\[M_{kp}=\underset{x\in[x_{k-1},x_k]}{max}|f^{(p)}(x)|,\quad h=\frac{H}
	{N}.\]
	Общая погрешность составной квадратурной формулы равна
	\[R^*(f)=\sum_{k=1}^{N}R_k(f)\]
	Очевидно, что $M_{kp}\le M_p$. Тогда окончательно получаем:
	\[|R^*(f)|=\Big|\sum_{k=1}^{N}R_k(f)\Big|\le\sum_{k=1}^{N}|R_k(f)|\le
	\sum_{k=1}^{N}\frac{M_{kp}|h|^{p+1}}{C}\le\sum_{k=1}^{N}\frac{M_{p}
	|h|^{p+1}}{C}=\]
	\[=N\frac{M_{p}|h|^{p+1}}{C}=\frac{M_p|H|^{p+1}}{CN^p}.\]
\end{proof}

При помощи данной теоремы выводятся погрешности составных формул из тех, что
мы уже знаем. Если мы знаем, что алгебраическая степень точности простой
формулы равна $p$, а сам отрезок интегрирования разделили на $N$ частей, то
точность гарантированно увеличится в $N^p$ раз.

Почему нельзя было применить простую квадратурную формулу на базе
интерполяционного полинома более высокой степени? Можно было, но тогда быстро
возрастает погрешность формулы, особенно на длинных интервалах интегрирования.
К тому же, строить квадратурные формулы высших степеней довольно трудоёмко.

\subfile{graphs/3.6-composite-rules}

\begin{example}
	Применим все 4 составные формулы к интегралу $I=\int_0^6 x^4 \;dx$. Его
	истинное значение равно $I=\frac{x^5}{5}\Big|_0^6=1555.2$.

	Все 4 формулы будут использовать по 6 элементарных отрезков длиной
	$h_\text{э}=1$. Соответственно, интегрирование идёт на узлах
	$\{0,1,...,6\}$.

	Составная формула средних прямоугольников
	\eqref{eq:composite_middlepoint_rectangle_rule}:
	\[I\approx1\cdot\sum_{k=1}^{N}f\Big(\frac{x_{k-1}+x_k}{2}\Big)=
	\frac{1}{16}(1^4+3^4+5^4+7^4+9^4+11^4)=1519.375.\]

	Составная формула трапеций \eqref{eq:composite_trapezoidal_rule}:
	\[I\approx\frac{1}{2}\Big(0^4+2\sum_{k=1}^{5}k^4+6^4\Big)=1627.\]

	Составная формула Симпсона \eqref{eq:composite_simpsons_1_3_rule} будет использовать
	по 2 элементарных отрезка, то есть она будет применена $N=3$ раза:
	\[I\approx\frac{2}{6}\Big(0^4+2(2^4+4^4)+4\sum_{k=1}^{3}(2k-1)^4+6^4
	\Big)=1556.\]

	Составная формула трёх восьмых \eqref{eq:composite_simpsons_3_8_rule} будет
	использовать по 3 элементарных отрезка, то есть она будет применена
	$N=2$ раза:
	\[I\approx\frac{3}{8}\Big(0^4+2\cdot 3^4+3\sum_{k=1}^{2}\big((3k-2)^4+
	(3k-1)^4\big)+6^4\Big)=1557.\]

	Оценим погрешности формул и сопоставим их с реальными.

	Оценка погрешности составной формулы прямоугольников
	\eqref{eq:middle_rectangle_rule_error}:
	\[|R_1(f)|\le6\;\frac{M_2\cdot |h|^3}{24}=108,\quad R_1(f)=35.825.\]

	Оценка погрешности составной формулы трапеций
	\eqref{eq:trapezoidal_rule_error}:
	\[|R_2(f)|\le6\;\frac{M_2\cdot |h|^3}{12}=216,\quad R_2(f)=-71.8.\]

	Оценка погрешности составной формулы Симпсона
	\eqref{eq:simpsons_1_3_rule_error}, $h=2$:
	\[|R_3(f)|\le3\;\frac{M_4\cdot |h|^5}{2880}=0.8,\quad R_3(f)=-0.8.\]

	Оценка погрешности составной формулы трёх восьмых
	\eqref{eq:simpsons_3_8_rule_error}, $h=3$:
	\[|R_4(f)|\le2\;\frac{M_4\cdot |h|^5}{6480}=1.8,\quad R_4(f)=-1.8.\]

	Как итог, составная формула Симпсона показала лучший результат, формула
	трапеций -- худший. Погрешности формул Симпсона и трёх восьмых достигли
	своих оценок.
\end{example}

\end{document}
