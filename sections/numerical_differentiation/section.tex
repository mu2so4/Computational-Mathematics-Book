\documentclass[../main.tex]{subfile}

\begin{document}

\section{Методы численного дифференцирования}
Как и интегрирование, дифференцирование функции тоже далеко не всегда можно
провести аналитическими методами, например, если функция задана таблично. Также
формулы численного дифференцирования используются для решения дифференциальных
уравнений.

\subsection{Разностные операторы}
\begin{define}\label{eq:difference_operator}
	\textbf{Разностный оператор} $\Lambda_h[y(x)]$ с $k$-ым порядком
	аппроксимации \textbf{аппроксимирует} дифференциальный оператор
	$F[y(x)]$, если для всех достаточно гладких функций $y(x)$ выполняется
	условие
	\[\big|\Lambda_h[y(x)]-F[y(x)]\big|\le O(h^k),\]
	и при этом для некоторых $y(x)$ достигается равенство.
\end{define}

\begin{define}
	Разность $\Lambda_h[y(x)]-F[y(x)]$ называется \textbf{погрешностью}
	разностного оператора.
\end{define}

\begin{define}
	\textbf{Главный член ошибки} или \textbf{невязки} -- первый член
	погрешности разностного оператора, который содержит в себе производную
	$y(x)$ наименьшего порядка. Обозначается как $\Delta_h[y(x)]$.

	Если $\Lambda_h[y(x)]$ аппроксимирует $n$-ую производную функции
	$y(x)\in C^{n+k}$ с $k$-ым порядком аппроксимации, то $\Delta_h[y(x)]=
	c(h)y^{(n+k)}(x)$, где $c(h)$ -- константа, зависящая от $h$.
\end{define}

\begin{define} \label{eq:simpliest_difference_operators}
	Определим простейщие разностные операторы 1-го порядка:
	\[\Lambda_h^+[y(x)]=\frac{y(x+h)-y(x)}{h},\qquad
	\Lambda_h^-[y(x)]=\frac{y(x)-y(x-h)}{h}.\]
\end{define}

\begin{lemma}
	Данные разностные операторы аппроксимируют первую производную для всяких
	$y(x)\in C^3$ с первым порядком аппроксимации.
\end{lemma}

\begin{proof}
	Для определённости рассмотрим $\Lambda_h^+[y(x)]$; для \\
	$\Lambda_h^-[y(x)]$ доказательство аналогичное. Разложим функцию
	$y(x+h)$ в ряд Тейлора по $h$ при $h=0$ с точностью до $h^3$:
	\[f(x+h)=y(x)+hy'(x)+\frac{h^2}{2}y''(x)+\frac{h^3}{6}y'''(x)
	+O(h^4).\]
	Тогда
	\[\Lambda_h^+[y(x)]=y'(x)+\frac{h}{2}y''(x)+\frac{h^2}{6}
	y'''(x)+O(h^3),\]
	\[\Lambda_h[y(x)]-F[y(x)]=\frac{h}{2}y''(x)+\frac
	{h^2}{6}y'''(x)+O(h^3)\Rightarrow \Delta_h[y(x)]=\frac{h}{2}y''(x).\]
\end{proof}

\begin{define}
	Разностные операторы из \eqref{eq:simpliest_difference_operators}
	относятся к \textbf{операторам направленной разности} (вперёд и назад
	соответственно). Из них можно составить оператор \textbf{симметричной}
	разности:
	\[\Lambda_h^*[y(x)]=\frac{\Lambda_h^+[y(x)]+\Lambda_h^-[y(x)]}{2}=
	\frac{y(x+h)-y(x-h)}{2h}.\]
\end{define}

\begin{lemma}
	Данный разностный оператор аппроксимирует первую производную для всяких
	$y(x)\in C^5$ со вторым порядком аппроксимации.
\end{lemma}

\begin{proof}
	Воспользовавшись разложением
	\[y(x\pm h)=y(x)\pm hy'(x)+\frac{h^2}{2!}y''(x)\pm\frac{h^3}{3!}y'''(x)+
	\frac{h^4}{4!}y^{(4)}(x)\pm\frac{h^5}{5!}y^{(5)}(x)+O(h^6),\]
	получим, что
	\[\Lambda_h^*[y(x)]=y'(x)+\frac{h^2}{6}y'''(x)+\frac{h^4}{120}y^{(5)}(x)
	+O(h^5).\]
\end{proof}

\begin{remark}
	Повышение порядка аппроксимации требует повышение гладкости
	аппроксимируемой функции.
\end{remark}

\subsection{Разностный оператор в общем виде}
Здесь мы рассмотрим общую задачу аппроксимации производных разностными
операторами.

\begin{define}\label{eq:general_difference_operator}
	Разностный оператор, аппроксимирующий производную $y^{(n)}(x)$, в общем
	виде имеет запись
	\[\boxed{\Lambda_h[y(x)]=\frac{1}{h^n}\sum_{j\in M}a_jy(x+jh)},\]
	где $M$ -- некоторое конечное множество чисел -- \underline{шаблон
	оператора}, -- а \\ $\{a_j\mid j\in M\}$ -- \underline{множество констант}.
\end{define}

\begin{theorem}\label{eq:general_difference_operator_theorem}
	Если для функции $y(x)$, шаблона оператора $M$, а также для множества
	констант $\{a_j\mid j\in M\}$ выполняются следующие условия:
	\begin{enumerate}[noitemsep]
		\item $y(x)\in C^{n+k+1}$,
		\item $\forall m\in\overline{0,n-1}\cup\overline{n+1,n+k-1}
			\quad\mathlarger\sum_{j\in M}a_jj^m=0$, считая при этом
			$0^0=1$,
		\item $\mathlarger\sum_{j\in M}a_jj^n=n!$,
		\item $\mathlarger\sum_{j\in M}a_jj^{n+k}\ne 0$,
	\end{enumerate}
	то разностный оператор \eqref{eq:general_difference_operator}
	аппроксимирует производную $y^{(n)}(x)$ с $k$-ым порядком аппроксимации,
	а его главный член невязки имеет вид
	\[\boxed{\Delta_h[y(x)]=\frac{h^k}{(n+k)!}\Big(\sum_{j\in M}a_jj^{n+k}\Big)
	y^{(n+k)}(x)}.\]
\end{theorem}

\begin{proof}
	Разложим в ряд Тейлора функцию:
	\[y(x+jh)=\sum_{m=0}^{n+k}\frac{(jh)^m}{m!}y^{(m)}(x)+O(h^{n+k+1}).\]

	Подставим это в $\Lambda_h[y(x)]$ и поменяем порядок суммирования:
	\[\Lambda_h[y(x)]=\frac{1}{h^n}\sum_{j\in M}a_j\sum_{m=0}^{n+k}\Big(
	\frac{(jh)^m}{m!}y^{(m)}(x)+O(h^{n+k+1})\Big)=\]
	\[=\sum_{m=0}^{n+k}\Big(\frac{h^{m-n}}{m!}y^{(m)}(x)\sum_{j\in M}
	a_jj^m\Big)+O(h^{k+1})=y^{(m)}(x)+\Delta_h[y(x)]+O(h^{k+1}).\]
\end{proof}

\begin{corollary}
	Если в предыдущей теореме известно, что
	\begin{enumerate}[nosep]
		\item $|M|<n+k$, то задача построения разностного оператора чаще
			всего (см. контрпример \eqref{eq:central_do_example})
			не имеет решения.
		\item $|M|=n+k$, то задача построения разностного оператора
			 имеет единственное решение.
		\item $|M|>n+k$, то задача построения разностного оператора
			образует $(|M|-n-k)$-параметрическое семейство.
	\end{enumerate}
\end{corollary}

\begin{example}
	Построим разностный оператор $n=1$ производной и с $k=2$ порядком
	аппроксимации на шаблоне $M=\{0,1,2\}$. Составим систему уравнений:
	\begin{equation*}
		\begin{cases}
			a_0+a_1+a_2=0, \\
			0+a_1+2a_2=1, \\
			0+a_1+4a_2=0. \\
		\end{cases}
		\Rightarrow
		\begin{cases}
			a_0 = -\frac{3}{2}, \\
			a_1 = 2, \\
			a_2 = -\frac{1}{2}. \\
		\end{cases}
	\end{equation*}

	Тогда желаемый разностный оператор имеет вид
	\[\Lambda_h[y(x)]=\frac{-3y(x)+4y(x+h)-y(x+2h)}{2h}.\]

	Найдём его главный член ошибки:
	\[\Delta_h[y(x)]=\frac{h^2}{3!}\big(0^3a_0+1^3a_1+2^3a_2\big)y'''(x)=
	-\frac{h^2}{3}y'''(x).\]
\end{example}
\newpage

\subsection{Симметричные разностные операторы}
Более внимательно рассмотрим симметричные операторы.

\begin{define}\label{eq:central_difference_operator}
	Разностный оператор \eqref{eq:general_difference_operator} является
	\textbf{симметричным}, если $\forall j\in M$ выполняется
	$a_j=(-1)^na_{-j}$, где $n$ -- порядок производной, чья аппроксимация
	ищется.
\end{define}

Из этого определения следует, что шаблон оператора $M$ -- множество,
симметричное относительно нуля

\begin{theorem}
	Если для функции $y(x)$, шаблона оператора $M$, а также для множества
	констант $\{a_j\mid j\in M\}$ выполняются следующие условия:
	\begin{enumerate}[noitemsep]
		\item $y(x)\in C^{n+k+1}$,
		\item $k$ чётное,
		\item Если $n$ чётное, то $a_0+2\sum_{j\in M_+}a_j=\delta_{0n}$,
			где $M_+=\{j\in M\mid j>0\}$,
		\item	\begin{equation*}
				\sum_{j\in M_+}a_jj^m=
				\begin{cases}
					0, m\in \{l\in\overline{1,n+k-2}\mid l
						\text{ и }n\text{ одной
						чётности}\}\backslash\{n\}; \\
					\frac{n!}{2}, m=n; \\
					\text{не } 0, m=n+k.
				\end{cases}
			\end{equation*}
	\end{enumerate}
	то симметричный разностный оператор
	\eqref{eq:central_difference_operator} аппроксимирует производную
	$y^{(n)}(x)$ с $k$-ым порядком аппроксимации, а главный член ошибки
	имеет вид
	\[\Delta_h[y(x)]=\frac{2h^k}{(n+k)!}\Big(\sum_{j\in M_+}a_jj^{n+k}\Big)
	y^{(n+k)}(x).\]
\end{theorem}

\begin{proof}
	Из определения следует, что сумма $\mathlarger\sum_{j\in M}a_jj^m$ равна
	нулю при всяких $m$, не совпадающих по чётности с порядком производной
	$n$. Также отсюда вытекает условие аппроксимировать производные с
	чётными порядками аппроксимации, потому что нечётный порядок всегда
	можно увеличить на единицу.

	В случае положительных $m$, совпадающих по чётности с $n$, выражение
	можно сократить в два раза, оставив, например, только положительные $j$.

	Условие 3 гарантирует равенство нулю суммы коэффициентов в случае чётной
	производной. В случае же нечётной производной, все парные коэффициенты
	сократят друг друга, а если $0\in M$, то $a_0=0$.
	
	Тогда мы можем  по теореме \eqref{eq:general_difference_operator_theorem}
	построить необходимый разностный оператор, главный член ошибки которой
	будет иметь заявленную форму независимо от чётности производной.
\end{proof}

\begin{example}\label{eq:central_do_example}
	Построим симметричный разностный оператор $n=2$ производной и с $k=4$
	порядком аппроксимации на шаблоне $M=\{-2,-1,0,1,2\}$.

	Можно подумать, что задача неразрешима, потому что $|M|<n+k$. Однако
	нас выручает то, что $0\in M$, который в паре сам с собой, что
	восполняет недостаток.

	Запишем и решим систему уравнений:
	\begin{equation*}
		\begin{cases}
			a_0 + 2a_1 + 2a_2 = 0, \\
			a_1 + 4a_2 = 2, \\
			a_1 + 16a_2 = 0. \\
		\end{cases}
		\Rightarrow
		\begin{cases}
			a_0 = -5, \\
			a_1 = \frac{8}{3}, \\
			a_2 = -\frac{1}{6}.\\
		\end{cases}
	\end{equation*}

	Тогда разностный оператор имеет вид
	\[\Lambda_h[y(x)]=\frac{-y(x-2h)+16y(x-h)-30y(x)+16y(x+h)-y(x+2h)}
	{6h^2}.\]

	Теперь найдём его главный член ошибки:
	\[\Delta_h[y(x)]=\frac{2h^4}{6!}\big(0^6a_0+1^6a_1+2^6a_2\big)y^{(6)}
	(x)=-\frac{h^4}{45}y^{(6)}(x).\]
\end{example}

\subsection{Разностный оператор на минимальном равномерном точечном шаблоне}

\begin{define}
	Шаблон оператора мощности $N+1$ называется \textbf{равномерным}, если \\
	$M=\{j_0+hk\mid k\in\overline{0,N}\}$, где $j_0$ -- некоторая константа,
	а $h$ -- шаг между точками шаблона.
\end{define}

\begin{define}
	\textbf{Оператор сдвига} $T_s$ -- оператор такой, что
	$\; T_s\circ y(x)=y(x+s)$.
\end{define}

\begin{lemma}
	Оператор сдвига $T_s$ является линейным.
\end{lemma}

\begin{proof}
	Очевидно.
\end{proof}

\begin{define}
	Введём следующие обозначения:
	\begin{itemize}[nosep]
		\item $T_0=E$.
		\item Если в контестке минимальный шаг сдвига равен $h$, то
			$T_{jh}=T_j$.
		\item Композиция операторов сдвига $T$: $\underset{j\text{ раз}}
			{\underbrace{T\circ T\circ...\circ T}}=T^j$.
		\item Общая запись разностного оператора на равномерном шаблоне:
			\[\Lambda_h[y(x)]=\frac{1}{h^n}\sum_{j=0}^{n}a_jy(x+jh)=
			\frac{1}{h^n}\Big(\sum_{j=0}^{n}T_{jh}\Big)\circ y(x)=
			\frac{1}{h^n}\underset{P_n(T)}{\underbrace{\Big(
			\sum_{j=0}^{n}T_j\Big)}}\circ y(x).\]
	\end{itemize}
\end{define}

\begin{theorem}
	Разностный оператор, аппроксимирующий $n$-ую производную на равномерном
	шаблоне, имеет вид
	\[\boxed{\Lambda_h[y(x)]=\frac{1}{h^n}\Big(\sum_{k=0}^{n}(-1)^kC_n^k\;
	T_{kh}\Big)\circ y(x)},\quad C_n^k=\frac{n!}{(n-k)!\;k!}.\]
\end{theorem}

\begin{proof}
	Рассмотрим разностный оператор, аппроксимирующий первую производную
	\[\Lambda_h^1[y(x)]=\Big(\frac{T_h-E}{h}\Big)\circ y(x)=\frac{y(x+h)-
	y(x)}{h}.\]
	Вторую производную мы найдём ''дифференцированием'' первой:
	\[\Lambda_h^2[y(x)]=\Big(\frac{T_h-E}{h}\Big)\circ\Lambda_h^1[y(x)]=
	\frac{1}{h^2}(T_h-E)^2\circ y(x).\]

	Аналогичным образом получаем, что
	\[\Lambda_h[y(x)]=\Lambda_h^n[y(x)]=\frac{1}{h^n}(T_h-E)^n\circ y(x).\]

	Зная, что $T^a\circ T^b=T^{a+b}$, разложим степень по биному Ньютона
	и получим требуемую форму.
\end{proof}

\begin{corollary}
	Симметричный разностный оператор, апппроксимирующий $y^{(n)}(x)$ на 
	равномерном $n+1$ шаблоне, имеет вид
	\[\boxed{\Lambda_h[y(x)]=\frac{1}{h^n}\Big(\sum_{k=0}^{n}(-1)^kC_n^k\;
	T_{kh}\Big)\circ T_{-\frac{nh}{2}}\circ y(x)},\quad C_n^k=\frac{n!}
	{(n-k)!\;k!}.\]
\end{corollary}

\subsection{Аппроксимация разностных схем дифференциальных уравнений}
Плавно приходим к тому, зачем это всё затевалось. А затевалось оно всё для
численного решения дифференциальных уравнений.

\begin{define}\label{eq:difference_scheme}
	\textbf{Разностная схема} разностого оператора $\Lambda_h[y]$
	\eqref{eq:difference_operator} -- это уравнение вида
	\[\Lambda_h[y]=0.\]
\end{define}

\begin{define}\label{eq:differential_equation_approximation}
	Разностная схема $\Lambda_h[y]=0$ аппроксимирует с $k$-м порядком
	дифференциальное уравнение $F[y]=0$ в смысле определения
	\eqref{eq:difference_operator}, если $\forall y(x)\in C^m$ верно
	$\big|\Lambda_h[y]\big|\le O(h^k)$, а для некоторых $y(x)$ достигается
	равенство.
\end{define}

\begin{theorem}[тривиальная]
	Если разностный оператор $\Lambda_h$ с $k$-м порядком аппроксимации
	аппроксимирует дифференциальный оператор $F[y]$, то разностная схема
	$\Lambda_h[y]=0$ аппроксимирует дифференциальное уравнение $F[y]=0$
	с порядком \underline{не ниже} $k$.
\end{theorem}

\begin{proof}
	Это напрямую следует из определения \eqref{eq:difference_operator}.
	Для этого достаточно подставить в него $F[y]=0$.

	Почему именно не ниже $k$? Потому что в условии может попасться
	такая функция $y(x)$, что по определению
	\eqref{eq:differential_equation_approximation} в неравенстве может быть
	достигнуто равенство. Но среди решений ДУ таких функций может и не быть,
	что и обеспечивает более высокую степень аппроксимации. См. пример
	\eqref{eq:differential_equation_shift_example}.
\end{proof}

И хотя эта теорема тривиальная, она очень важна, потому что позволяет создать
методы построения схем повышенной точности.

\begin{example}\label{eq:differential_equation_simpliest_example}
	Необходимо решить обыкновенное дифференциальное уравнение
	\[y'(x)=g(x);\quad F[y]=y'(x)-g(x).\]

	Построим простейшую разностную схему, аппроксимирующую это уравнение.
	Воспользуемся для этого направленным вперёд разностным оператором
	первого порядка \eqref{eq:simpliest_difference_operators}. Рассмотрим
	разностный оператор
	\[\Lambda_h[y(x)]=\frac{y(x+h)-y(x)}{h}+g(x).\]

	Исследуем, с каким порядком данный разностный оператор аппроксимирует
	дифференциальное уравнение. Разложим $y(x)$ в ряд Тейлора по $h$ при
	$h=0$:
	\[y(x+h)=y(x)+hy'(x)+\frac{h^2}{2}y''(x)+O(h^3).\]
	Здесь и далее будем писать $y$ и $g$ вместо $y(x)$ и $g(x)$
	соответственно. В этих обозначениях
	\[\Lambda_h[y]=y'+\frac{h}{2}y''-g'+O(h^2),\]
	\[\Lambda_h[y]-F[y]=\underset{\Delta_h[y]}{\underbrace{\frac{h}{2}y''}}
	+O(h^2),\]
	получаем, что разностный оператор аппроксимирует дифференциальный
	оператор с первым порядком, если вторая производная $y$ отлична от нуля.
	В противном случае порядок аппроксимации будет выше. К тому же, если бы
	эта функция $y$ была линейной, то аппроксимация была бы точной.

	А вот так данная схема аппроксимиурует уравнение:
	\[\Lambda_h[y,g]-\underset{0}{\underbrace{F[y,g]}}=\Lambda_h[y,g]=
	\frac{h}{2}y''+O(h^2),\]
	то есть порядок аппроксимации уравнения совпал с порядком аппроксимации
	соответствующего оператора.
\end{example}

\begin{example}\label{eq:differential_equation_central_example}
	Решим то же уравнение, что и в прошлом примере
	\eqref{eq:differential_equation_simpliest_example}, но теперь при помощи
	симметричной разностной схемы
	\[\Lambda_h[y]=\frac{f(x+h)-f(x-h)}{2h}-g(x).\]

	Как и тогда, разложим в ряд Тейлора:
	\[y(x\pm h)=y(x)\pm hy'(x)+\frac{h^2}{2}y''(x)\pm\frac{h^3}{6}y'''(x)+
	\frac{h^3}{6}y^{(4)}(x)+O(h^5).\]

	Подставив это, получим
	\[\Lambda_h=y'+\frac{h^2}{6}y'''+O(h^4)\quad\Rightarrow\quad
	\Lambda_h-F=\frac{h^2}{6}y'''+O(h^4),\]
	то есть и тут порядок аппроксимации оператора совпал с порядком
	аппроксимации уравнения.
\end{example}

\subsection{Повышение порядка РО за счёт диф. следствий аппроксимируемого
уравнения}

\begin{theorem}
	Если разностный оператор $\Lambda_h$ аппроксимирует дифференциальный
	оператор \eqref{eq:difference_operator} на каком-то шаблоне с $k$-ым
	порядком, то порядок аппроксимации оператора $T_{ch}\circ\Lambda_h$
	упадёт до первого порядка, а порядок аппроксимации соотвествующей
	схемы \eqref{eq:difference_scheme} сохранится.
\end{theorem}

\begin{proof}
	Рассмотрим разностный оператор $\Lambda_h[y(x)]=F[y(x)]$.
	Разложим в ряд Тейлора по $h$ при $h=0$:
	\[\Lambda_h[y(x)]=F[y(x)]+O(h^k).\]

	Подействуем оператором сдвига $T_{ch}$ и снова разложим в ряд Тейлора:
	\[T_{ch}\circ\Lambda_h[y(x)]=F[y(x+ch)]+O(h^k)=F[y(x)]+O(h).\]

	В разностной же схеме у нас $F[y]=0$, тогда
	\[T_{ch}\circ\Lambda_h[y(x)]=T_{ch}\circ\big(\cancel{F[y(x)]}+O(h^k)
	\big)=O(h^k).\]
\end{proof}

\begin{define}
	Если известно, что $y(x)=g(x)$ на некотором отрезке и они достаточно
	гладкие ($\in C^n([a,b])$), то равенство $y^{(n)}(n)=g^{(n)}(x)$
	называется \textbf{дифференциальным следствием} $n$-го порядка.
\end{define}

\begin{example}\label{eq:differential_equation_shift_example}
	Решим уравнение из примера
	\eqref{eq:differential_equation_central_example} при помощи той же
	разностной схемы, но сдвинутой на $h$:
	\[\Lambda_h[y(x)]=\frac{y(x+2h)-y(x)}{2h}-g(x+h)=0.\]

	Разложим в ряд Тейлора $y(x+2h)$ и $g(x)$:
	\[y(x+2h)=y(x)+2hy'(x)+2h^2y''(x)+O(h^3),\]
	\[g(x+h)=g(x)+hg'(x)+O(h^2).\]

	Обозначив $y=y(x)$ и $g=g(x)$, получаем:
	\[\Lambda_h=y'+hy''+O(h^2)-g-hg'=
	(y'-g)+h(y''-g')+O(h^2).\]

	Если решение достаточно гладкое, то применимо дифференциальное
	следствие первого порядка:
	\[\Lambda_h[y]-F[y]=O(h^2).\]

	Таким образом, сдвиг ''испортил'' степень аппроксимации
	дифференциального оператора, но не схемы.
\end{example}
\newpage

\subsection{Компактные разностные схемы}
Идея компактных разностных схем -- использовать шаблон с максимальной
эффективностью, чтобы получить из него наибольшую степень аппроксимации. Для
этого помимо производных $y(x)$ аппроксимируют функцию $g(x)$.

\begin{define}
	\textbf{Компактная разностная схема} -- разностная схема
	$\Lambda_h[y,g]=0$, в которой содержатся аппроксимации производной
	$y^{(n)}(x)$ и функции $g(x)$ на одном и том же шаблоне. Компактная
	разностная схема записывается следующим образом:
	\[\Lambda_h\big[y(x),g(x)\big]=\overline{\Lambda}_h\big[y(x)\big]-
	\Omega_h\big[g(x)].\]
\end{define}

\begin{theorem}[о компактной разностной схеме]
	Если компактная разностная схема $\Lambda_h[y(x),g(x)]$ аппроксимирует
	решение дифференциального уравнения $y^{(n)}-g=0$ на шаблоне $M$ с $k$-м
	порядком аппроксимации, разностный оператор $\overline{\Lambda}_h[y]$
	построен на коэффициентах $a_j$, а $\Omega_h\big[g(x)]$ -- на $b_j$, то
	для коэффициентов верно соотношение
	\[\boxed{\forall i\in\overline{1,k-1}\quad m!\sum_{j\in M}a_jj^m=(n+m)!
	\sum_{j\in M}b_jj^m}.\]
\end{theorem}

\begin{proof}
	Запишем разностные операторы через коэффициенты:
	\[\Lambda_h[y(x),g(x)]=\overline{\Lambda}_h[y(x)]-\Omega_h[g(x)]=0,\]
	\[\text{где }\overline{\Lambda}_h[y]=\frac{1}{h^n}\sum_{j\in M}a_j
	y(x+jh),\quad\Omega_h[g]=\sum_{j\in M}b_jg(x+jh).\]

	Распишем наше дифференциальное уравнение:
	\[y^{(n)}-g=\frac{1}{h^n}\sum_{j\in M}a_jy(x+jh)-\sum_{j\in M}b_j
	g(x+jh)+O(h^{k+1})=\]
	\[=\frac{1}{h^n}\sum_{j\in M}a_j\sum_{m=0}^{n+k} \frac{(jh)^m}{m!}
	y^{(m)}(x)-\sum_{j\in M}b_j\sum_{m=0}^{k}\frac{(jh)^m}{m!}g^{(m)}(x)+
	O(h^{k+1})=\]
	\[=\sum_{m=0}^{n+k}\frac{h^{m-n}}{m!}y^{(m)}(x)\sum_{j\in M}a_jj^m-
	\sum_{m=0}^{k}\frac{h^m}{m!}g^{(m)}\sum_{j\in M}b_jj^m+O(h^{k+1}).\]

	Tеорема \eqref{eq:general_difference_operator_theorem} позволяет
	установить следующие свойства коэффициентов $a_j$ и $b_j$:
	\begin{enumerate}
		\item $\sum_{j\in M}a_jj^m=0,m\in\{0,...,n-1\}\backslash\{n\}$,
		\item $\sum_{j\in M}a_jj^n=n!$,
		\item $\sum_{j\in M}b_j=1$.
	\end{enumerate}

	Тогда
	\[y^{(n)}-g=y^{(n)}+\sum_{m=n+1}^{n+k}\frac{h^{m-n}}{m!}y^{(m)}(x)
	\sum_{j\in M}a_jj^m-\]
	\[-g-\sum_{m=1}^{k}\frac{h^m}{m!}g^{(m)}\sum_{j\in M}b_jj^m+O(h^{k+1})=
	y^{(n)}-g+S+O(h^{k+1}).\]

	Обозначим $m-n=s\Rightarrow m=n+s$ и продолжим считать суммы $S$:
	\[S=\sum_{s=1}^{k}\frac{h^s}{(n+s)!}y^{(n+s)}\sum_{j\in M}a_jj^{n+s}-
	\sum_{m=1}^{k}\frac{h^m}{m!}g^{(m)}(x)\sum_{j\in M}b_jj^m.\]

	В первой сумме обозначим переменную цикла $s$ как $m$:
	\[S=\sum_{m=1}^{k}h^m\Big(\frac{1}{(n+m)!}y^{(n+m)}(x)\sum_{j\in M}a_j
	j^m-\frac{1}{m!}g^{(m)}(x)\sum_{j\in M}b_jj^m\Big).\]

	И наконец, применив дифференциальные следствия, получаем требуемые
	условия на коэффициенты.
\end{proof}

\begin{remark}
	Порядки аппроксимации разностных операторов $\overline{\Lambda}_h[y(x)]$
	и $\Omega_h[g(x)]$ не влияют на порядок аппроксимации компактной
	разностной схемы, хотя высокий порядок аппроксимации позволяет упростить
	систему уравнений из коэффициентов.
\end{remark}

\begin{remark}
	Чтобы задача построения компактной разностной схемы была разрешима,
	достаточно, чтобы
	\begin{itemize}
		\item $|M|\ge n+1$,
		\item $2|M|\ge n+k+1$.
	\end{itemize}
\end{remark}

Однако мы не станем рассматривать примеры применения этой теоремы, так как она
слишком тяжеловесная.

\begin{example}
	Решим уравнение $y'(x)-g(x)=0$ на трёхточечном шаблоне $\{-1,0,1\}$ при
	помощи компактной разностной схемы и попробуем добиться $k=4$ степени
	аппроксимации. Аппроксимируем $g(x)$ по трём точкам на этом симметричном
	шаблоне и введём параметр $\alpha$:
	\[\Lambda_h=\frac{y(x+h)-y(x-h)}{2h}-\big(\alpha g(x-h)+(1-2\alpha)g(x)+
	\alpha g(x+h)\big).\]

	Теперь попробуем найти этот параметр, но сначала разложим всё в ряды
	Тейлора, а также обозначим $y=y(x)$ и $g=g(x)$:
	\[g(x\pm h)=g\pm hg'+\frac{h^2}{2}g''\pm\frac{h^3}{6}g'''+O(h^4),\]
	\[\Lambda_h=y'+\frac{h^2}{6}y'''-g-\alpha h^2g''+O(h^4)=
	(y'-g)+\Big(\frac{h^2}{6}y'''-\alpha h^2g''\Big).\]

	Воспользовавшись дифференциальным следствием первого порядка, получаем,
	что $\alpha=\frac{1}{6}$.

	Запишем данный разностный оператор в операторной форме:
	\[A\circ g(x)=\frac{1}{6}\Big(g(x-h)+4g(x)+g(x+h)\Big)=\frac{T_{-h}+4E+
	T_h}{6}\circ g(x)\]
	\[\Delta\circ y(x)=\frac{T_h-T_{-h}}{2h}\circ y(x),\]
	тогда
	\[\Delta\circ y=A\circ g.\]
\end{example}

\begin{example}
	Решим уравнение $y''(x)-g(x)=0$ на трёхточечном шаблоне $\{-1,0,1\}$
	при помощи компактной разностной схемы. Далее мы будем писать $y$ вместо
	$y(x)$ и $g$ вместо $g(x)$.

	Аппроксимируем вторую производную симметричным оператором (настоятельно
	рекомендую знать, как это делать, иначе сразу пересдача), а функцию
	$g$ -- по трём точкам, как в предыдущем примере:
	\[\Lambda_h[y,g]=\frac{y(x+h)-2y+y(x-h)}{h^2}-\big(\alpha g(x-h)+
	(1-2\alpha)g+\alpha g(x+h)\big).\]

	Разложим в ряд Тейлора по $h$ при $h=0$:
	\[y(x\pm h)=y\pm hy'+\frac{h^2}{2}y''\pm \frac{h^3}{6}y'''+\frac{h^4}{6}
	y^{(4)}\pm\frac{h^5}{120}y^{(5)}+O(h^6),\]
	тогда разностный оператор равен:
	\[\Lambda_h[y,g]=y''+\frac{h^2}{12}y^{(4)}-g-\alpha h^2g''+O(h^4)=
	(y''-g)+h^2\big(\frac{1}{12}y^{(4)}-\alpha g''\big)+O(h^4).\]

	Применив дифференциальное следствие 1-го порядка, получаем, что при
	$\alpha=\frac{1}{12}$ данное дифференциальное уравнение аппроксимируется
	с четвёртым порядком аппроксимации. Выразим соответствующий оператор $A$:
	\[\Omega_h[g]=\frac{1}{12}\big(g(x-h)+10g+g(x+h)\big)=
	\frac{(T_{-h}+10E+T_h)}{12}\circ g=A\circ g.\]
\end{example}

\end{document}
